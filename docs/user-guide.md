# Руководство пользователя

## Обзор интерфейса

Веб-интерфейс состоит из трёх основных зон:

```
+----------------------------------------------------------+
| Header: название, кнопка помощи, пользователь, выход     |
+-------------+--------------------------------------------+
|             | Информация о сервере: диск, использование   |
| Подключения +--------------------------------------------+
| (боковая    | Таблицы                                    |
|  панель)    | список с размерами и датами запросов       |
|             |                  Детали таблицы (правая     |
|             |                  выдвижная панель):         |
|             |                  Колонки / История / Flow   |
+-------------+--------------------------------------------+
```

## Авторизация

При первом входе откроется страница логина. Введите имя пользователя и пароль, назначенные администратором. Доступны две роли:

- **admin** - полный доступ: просмотр данных, управление подключениями
- **user** - только просмотр данных по существующим подключениям

## Подключение к серверу

1. Откройте боковую панель «Подключения» (кнопка-меню в шапке или стрелка слева)
2. Нажмите на карточку нужного подключения
3. При успешном подключении карточка подсветится, появится надпись «Connected»
4. Автоматически загрузится информация о сервере и список таблиц

Боковая панель автоматически скрывается после подключения. Чтобы открыть снова - нажмите стрелку у левого края экрана.

## Информация о сервере

После подключения в верхней части отображается:

- Имя подключения
- Для каждого диска: использованное / общее пространство, процент заполнения
- Цветовая индикация: зелёный (< 70%), жёлтый (70-90%), красный (> 90%)

## Просмотр таблиц

Центральная панель показывает все таблицы сервера (кроме системных баз данных). Для каждой таблицы отображается:

| Колонка | Описание |
|---------|----------|
| Table | Полное имя таблицы (база.таблица) |
| Size | Размер данных на диске |
| R | Признак репликации (иконка синхронизации) |
| Refs | Количество ссылающихся объектов (MV, словари и др.) |
| Last SELECT | Время последнего SELECT-запроса |
| Last INSERT | Время последней вставки данных |
| TTL | Правила TTL таблицы (если настроены) |

### Сортировка

Нажмите на заголовок колонки для сортировки. По умолчанию таблицы отсортированы по размеру (убывание).

### Пагинация

Внизу таблицы можно выбрать количество строк на странице: 20, 50, 100, 200 или «All».

### Ссылки (Refs)

Если у таблицы есть ссылающиеся объекты - число в колонке Refs кликабельно. Нажмите, чтобы увидеть список (материализованные представления, словари и др.). Список можно скопировать.

### Обновление

Кнопка «Refresh» под таблицей обновляет данные с сервера.

## Детали таблицы (правая панель)

Нажмите на строку таблицы - справа выедет панель деталей с тремя вкладками: **Columns**, **Query History**, **Flow**.

- Повторный клик по той же строке — скрывает панель
- Клик по другой строке — переключает на новую таблицу
- Кнопка `X` в правом верхнем углу панели — закрывает панель
- Клик по области таблиц (вне панели) — скрывает панель
- Стрелка у правого края экрана — открывает/скрывает панель

Ширину панели можно изменить перетаскиванием за левый край. Установленная ширина сохраняется в рамках сессии.

### Вкладка Columns

Показывает колонки выбранной таблицы:

| Колонка | Описание |
|---------|----------|
| Column | Имя колонки |
| Type | Тип данных ClickHouse (String, UInt64, DateTime и т.д.) |
| Codec | Кодек сжатия (LZ4, ZSTD и т.д.) |
| Size | Размер колонки на диске |
| Refs | Ссылки на колонку из других объектов |

Таблица сортируется по размеру - сразу видно, какие колонки занимают больше всего места.

### Вкладка Query History

Показывает историю запросов к выбранной таблице из `system.query_log`. Вкладка загружается лениво — данные запрашиваются только при первом переключении на неё.

**Фильтры** (над таблицей, в три строки):

Строка 1 — **User**: кнопки-плитки по пользователям (переносятся на новую строку при большом количестве). Синяя = показывать, серая = скрыть. Иконка корзины — сбросить все.

Строка 2 — **Kind**: аналогично по типу запроса (Select, Insert и т.д.). Иконка корзины — сбросить все.

Строка 3 — управляющие элементы:
- **Limit** — количество выводимых запросов (50, 100, 200, 500, 1000)
- **Direct** — переключатель. Если включён (по умолчанию), показываются только запросы, в тексте которых напрямую упоминается имя таблицы. Если выключен — показываются все запросы, с дополнительной колонкой «Direct» (+/пусто)
- **`</>`** — показывает SQL-запрос, которым приложение получает историю
- **Refresh** — обновить данные с сервера

Фильтры User и Kind связаны: при выборе пользователя недоступные для него типы запросов блокируются, и наоборот. Фильтрация выполняется на стороне сервера.

**Текстовый фильтр** — дополнительный поиск по любому полю в загруженных данных.

**Просмотр полного запроса** — нажмите иконку глаза слева от текста запроса:

- Отформатированный SQL (ключевые слова UPPERCASE, ClickHouse-функции в camelCase)
- Подсветка имени текущей таблицы (жёлтый маркер), с переключателем
- Кнопка Copy для копирования

### Вкладка Flow

Показывает потоки данных через выбранную таблицу в виде интерактивных диаграмм. Три под-вкладки:

- **MV Flow** — цепочка материализованных представлений: откуда данные приходят и куда уходят (по DDL из `system.tables`)
- **Query Flow** — цепочка переливки данных по истории запросов (`system.query_log`)
- **Full Flow** — объединённая диаграмма из обоих источников

На диаграмме: прямоугольники — таблицы, параллелограммы — материализованные представления. Текущая таблица выделена синим.

**Масштабирование**: кнопки `+` / `-` в правом верхнем углу изменяют масштаб диаграммы. Настройка сохраняется в рамках сессии.

## Просмотр сгенерированных запросов

Кнопка `</>` под таблицей таблиц показывает SQL-запросы, которыми приложение получает данные. Запросы можно скопировать.

## Помощь

Кнопка `?` в правой части шапки открывает встроенную документацию. Доступны разделы:

- Руководство пользователя (эта страница)
- [Руководство администратора](admin-guide.md)
- [Релизы](releases.md) — история изменений
